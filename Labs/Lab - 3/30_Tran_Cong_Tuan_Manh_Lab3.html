<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>593f71b9de24463e88543878bbc5ce73</title>
  <script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=JjofKkch2I_O5fQDIQ2wuneWDpINl6Dcpf4d6B24N3D9qaUuVgfnBYOrA3_lmL2Ijlu07RoR_uy6epge2jSL5Y6htSfd82n42bYBfxKRj7CD4zNS08wP-L4E-AwidMR_" charset="UTF-8"></script><style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<section id="lab-3---linear-regression" class="cell markdown">
<h1>Lab 3 - Linear Regression</h1>
<ul>
<li><p>Your name: Trần Công Tuấn Mạnh</p></li>
<li><p>Your student code: 19133035</p></li>
</ul>
</section>
<section id="i-hướng-dẫn" class="cell markdown">
<h2>I. Hướng dẫn</h2>
</section>
<section id="11-khởi-tạo-spark" class="cell markdown">
<h3>1.1. Khởi tạo Spark</h3>
</section>
<div class="cell code" data-execution_count="1">
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> findspark</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>findspark.init()</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyspark</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>findspark.find()</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> count</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> (SparkSession</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>         .builder</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>         .appName(<span class="st">&quot;Linear Regression&quot;</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>         .getOrCreate())</span></code></pre></div>
</div>
<section id="12-đọc-và-load-tập-dữ-liệu-boston-housing" class="cell markdown">
<h3>1.2. Đọc và load tập dữ liệu Boston housing</h3>
</section>
<div class="cell code" data-execution_count="3">
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>bostonDF <span class="op">=</span> (spark.read</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>            .option(<span class="st">&quot;HEADER&quot;</span>, <span class="va">True</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>            .option(<span class="st">&quot;inferSchema&quot;</span>, <span class="va">True</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>            .csv(<span class="st">&quot;BostonHousing.csv&quot;</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>bostonDF.show(<span class="dv">5</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>+-------+----+-----+----+-----+-----+----+------+---+---+-------+------+-----+----+
|   crim|  zn|indus|chas|  nox|   rm| age|   dis|rad|tax|ptratio|     b|lstat|medv|
+-------+----+-----+----+-----+-----+----+------+---+---+-------+------+-----+----+
|0.00632|18.0| 2.31|   0|0.538|6.575|65.2|  4.09|  1|296|   15.3| 396.9| 4.98|24.0|
|0.02731| 0.0| 7.07|   0|0.469|6.421|78.9|4.9671|  2|242|   17.8| 396.9| 9.14|21.6|
|0.02729| 0.0| 7.07|   0|0.469|7.185|61.1|4.9671|  2|242|   17.8|392.83| 4.03|34.7|
|0.03237| 0.0| 2.18|   0|0.458|6.998|45.8|6.0622|  3|222|   18.7|394.63| 2.94|33.4|
|0.06905| 0.0| 2.18|   0|0.458|7.147|54.2|6.0622|  3|222|   18.7| 396.9| 5.33|36.2|
+-------+----+-----+----+-----+-----+----+------+---+---+-------+------+-----+----+
only showing top 5 rows

</code></pre>
</div>
</div>
<section id="13-giới-thiệu-tập-dữ-liệu-boston-housing" class="cell markdown">
<h3>1.3. Giới thiệu tập dữ liệu Boston housing</h3>
<p><code>crim</code>: per capita crime rate by town.</p>
<p><code>zn</code>: proportion of residential land zoned for lots over 25,000 sq.ft.</p>
<p><code>indus</code>: proportion of non-retail business acres per town.</p>
<p><code>chas</code>: Charles River dummy variable (= 1 if tract bounds river; 0 otherwise).</p>
<p><code>nox</code>: nitrogen oxides concentration (parts per 10 million).</p>
<p><code>rm</code>: average number of rooms per dwelling.</p>
<p><code>age</code>: proportion of owner-occupied units built prior to 1940.</p>
<p><code>dis</code>: weighted mean of distances to five Boston employment centres.</p>
<p><code>rad</code>: index of accessibility to radial highways.</p>
<p><code>tax</code>: full-value property-tax rate per 10,000 dollars.</p>
<p><code>ptratio</code>: pupil-teacher ratio by town.</p>
<p><code>b</code> (<code>black</code>): <span class="math inline">1000(<em>B</em><em>k</em>−0.63)<sup>2</sup></span> where <span class="math inline"><em>B</em><em>k</em></span> is the proportion of blacks by town.</p>
<p><code>lstat</code>: lower status of the population (percent).</p>
<p><code>medv</code>: median value of owner-occupied homes in 1000 dollars.</p>
</section>
<section id="14-tạo-các-biến-input-features-và-output-label" class="cell markdown">
<h3>1.4. Tạo các biến input (features) và output (label)</h3>
</section>
<div class="cell markdown">
<p>Spark khác với nhiều machine learning framework khác ở chỗ ta cần huấn luyện mô hình của mình trên một cột duy nhất có chứa một vectơ gồm tất cả các feature (attribute) mà ta quan tâm. Ta sẽ chuẩn bị dữ liệu bằng cách tạo một cột có tên <code>features</code> gồm các thuộc tính <code>rm</code> (average number of rooms), <code>crim</code> (crime rate), và <code>lstat</code> (lower status of the population).</p>
<p>Thêm cột <code>features</code> vừa tạo vào data frame sử dụng <code>VectorAssembler</code>:</p>
</div>
<div class="cell code" data-execution_count="4">
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.feature <span class="im">import</span> VectorAssembler</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>featureCols <span class="op">=</span> [<span class="st">&quot;rm&quot;</span>, <span class="st">&quot;crim&quot;</span>, <span class="st">&quot;lstat&quot;</span>]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>assembler <span class="op">=</span> VectorAssembler(inputCols <span class="op">=</span> featureCols, outputCol <span class="op">=</span> <span class="st">&quot;features&quot;</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>bostonFeaturizedDF <span class="op">=</span> assembler.transform(bostonDF)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>bostonFeaturizedDF.show(<span class="dv">5</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>+-------+----+-----+----+-----+-----+----+------+---+---+-------+------+-----+----+--------------------+
|   crim|  zn|indus|chas|  nox|   rm| age|   dis|rad|tax|ptratio|     b|lstat|medv|            features|
+-------+----+-----+----+-----+-----+----+------+---+---+-------+------+-----+----+--------------------+
|0.00632|18.0| 2.31|   0|0.538|6.575|65.2|  4.09|  1|296|   15.3| 396.9| 4.98|24.0|[6.575,0.00632,4.98]|
|0.02731| 0.0| 7.07|   0|0.469|6.421|78.9|4.9671|  2|242|   17.8| 396.9| 9.14|21.6|[6.421,0.02731,9.14]|
|0.02729| 0.0| 7.07|   0|0.469|7.185|61.1|4.9671|  2|242|   17.8|392.83| 4.03|34.7|[7.185,0.02729,4.03]|
|0.03237| 0.0| 2.18|   0|0.458|6.998|45.8|6.0622|  3|222|   18.7|394.63| 2.94|33.4|[6.998,0.03237,2.94]|
|0.06905| 0.0| 2.18|   0|0.458|7.147|54.2|6.0622|  3|222|   18.7| 396.9| 5.33|36.2|[7.147,0.06905,5.33]|
+-------+----+-----+----+-----+-----+----+------+---+---+-------+------+-----+----+--------------------+
only showing top 5 rows

</code></pre>
</div>
</div>
<section id="15-tạo-mô-hình-linear-regression" class="cell markdown">
<h3>1.5. Tạo mô hình Linear Regression</h3>
</section>
<div class="cell markdown">
<p>Import thư viện linear regression và thiết lập output là thuộc tính <code>medv</code>, input là <code>features</code>. Tham khảo thêm về các tham số của thư viện LinearRegression ở <a href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.regression.LinearRegression.html#pyspark.ml.regression.LinearRegression">đây</a>.</p>
</div>
<div class="cell code" data-execution_count="5">
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.regression <span class="im">import</span> LinearRegression</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> LinearRegression(labelCol <span class="op">=</span> <span class="st">&quot;medv&quot;</span>, featuresCol <span class="op">=</span> <span class="st">&quot;features&quot;</span>)</span></code></pre></div>
</div>
<section id="16-fit-mô-hình-với-data" class="cell markdown">
<h3>1.6. Fit mô hình với data</h3>
</section>
<div class="cell code" data-execution_count="6">
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>lrModel <span class="op">=</span> lr.fit(bostonFeaturizedDF)</span></code></pre></div>
</div>
<section id="17-xem-các-tham-số-của-mô-hình-sau-khi-đã-fit-với-data" class="cell markdown">
<h3>1.7. Xem các tham số của mô hình sau khi đã fit với data</h3>
</section>
<div class="cell code" data-execution_count="7">
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Coefficients: </span><span class="sc">{0:.1f}</span><span class="st">, </span><span class="sc">{1:.1f}</span><span class="st">, </span><span class="sc">{2:.1f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="op">*</span>lrModel.coefficients))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Intercept: </span><span class="sc">{0:.1f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModel.intercept))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Coefficients: 5.2, -0.1, -0.6
Intercept: -2.6
</code></pre>
</div>
</div>
<div class="cell markdown">
<p><strong>Ý nghĩa</strong>: <span class="math inline"><em>p</em><em>r</em><em>e</em><em>d</em><em>i</em><em>c</em><em>t</em><em>e</em><em>d</em>_<em>m</em><em>e</em><em>d</em><em>v</em> = (5.2*<em>r</em><em>m</em>) − (0.1*<em>c</em><em>r</em><em>i</em><em>m</em>) − (0.6*<em>l</em><em>s</em><em>t</em><em>a</em><em>t</em>) − 2.6</span></p>
<p>hay <span class="math inline"><em>p</em><em>r</em><em>e</em><em>d</em><em>i</em><em>c</em><em>t</em><em>e</em><em>d</em>_<em>m</em><em>e</em><em>d</em><em>v</em> = (5.2*<em>n</em><em>u</em><em>m</em><em>b</em><em>e</em><em>r</em>_<em>o</em><em>f</em>_<em>r</em><em>o</em><em>o</em><em>m</em><em>s</em>) − (0.1*<em>c</em><em>r</em><em>i</em><em>m</em><em>e</em>_<em>r</em><em>a</em><em>t</em><em>e</em>) − (0.6*<em>l</em><em>o</em><em>w</em><em>e</em><em>r</em>_<em>c</em><em>l</em><em>a</em><em>s</em><em>s</em>) − 2.6</span></p>
</div>
<div class="cell markdown">
<p>Hai độ đo đánh giá thường được dùng là Root Mean Squared Error (RMSE) và R-Squared score (<span class="math inline"><em>R</em><sup>2</sup></span>).</p>
<p><span class="math display">$$RMSE(y, \hat{y}) = \sqrt{\frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y_i})^2}$$</span></p>
<p><span class="math display">$$R^2 = 1 - \frac{\sum_{i=1}^{n} (y_i - \hat{y_i})^2}{\sum_{i=1}^{n} (y_i - \overline{y})^2}$$</span></p>
<p>Trong đó:</p>
<ul>
<li><p><span class="math inline">$\hat{y_i}$</span> là giá trị mà mô hình cho <span class="math inline"><em>x</em><sub><em>i</em></sub></span></p></li>
<li><p><span class="math inline"><em>y</em><sub><em>i</em></sub></span> là output thật sự cho <span class="math inline"><em>x</em><sub><em>i</em></sub></span></p></li>
<li><p><span class="math inline"><em>n</em></span> là số lượng phần tử trong dữ liệu</p></li>
<li><p><span class="math inline">$\overline{y} = \frac{1}{n} \sum_{i=1}^{n} y_i$</span></p></li>
</ul>
</div>
<div class="cell code" data-execution_count="8">
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;R-Squared score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModel.summary.r2))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>R-Squared score: 0.6458520515781128
</code></pre>
</div>
</div>
<div class="cell markdown">
<p><strong>Ý nghĩa</strong>: mô hình có thể giải thích khoảng <span class="math inline">65%</span> sự biến thiên (variance) trong dữ liệu.</p>
</div>
<div class="cell markdown">
<p>Một số độ đo và chỉ số khác:</p>
</div>
<div class="cell code" data-execution_count="9">
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>lrModelSummary <span class="op">=</span> lrModel.summary</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;MAE score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModelSummary.meanAbsoluteError))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;RMSE score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModelSummary.rootMeanSquaredError))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Coefficient Standard Errors: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(lrModelSummary.coefficientStandardErrors))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;T Values: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(lrModelSummary.tValues))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P Values: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(lrModelSummary.pValues))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>MAE score: 3.8912949765069516
RMSE score: 5.4678160740273904
Coefficient Standard Errors: [0.44203471513494264, 0.03202221602654323, 0.047669471406803186, 3.1660227928472824]
T Values: [11.802138487700892, -3.214670921988166, -12.135352093519266, -0.8092964515972317]
P Values: [0.0, 0.0013900026454838343, 0.0, 0.41872805807608815]
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Các chỉ số <code>Standard Errors</code>, <code>t-values</code>, <code>p-values</code> liên quan đến ý nghĩa thống kê (statistically significant) của các hệ số (tham số) của mô hình. Xem thêm về diễn giải của các chỉ số này ở <a href="https://dss.princeton.edu/online_help/analysis/interpreting_regression.htm">đây</a> hoặc <a href="https://boostedml.com/2019/06/linear-regression-in-r-interpreting-summarylm.html">đây</a>.</p>
</div>
<section id="18-sử-dụng-mô-hình" class="cell markdown">
<h3>1.8. Sử dụng mô hình</h3>
<p>Chọn ra 10 dòng dữ liệu đầu tiên (xem như nó là dữ liệu mới). Ta sẽ xem dự đoán của mô hình trên 10 dòng dữ liệu này và cho sánh nó với giá trị thực tế.</p>
</section>
<div class="cell code" data-execution_count="10">
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>subsetDF <span class="op">=</span> (bostonFeaturizedDF</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>            .limit(<span class="dv">10</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>            .select(<span class="st">&quot;features&quot;</span>, <span class="st">&quot;medv&quot;</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>subsetDF.show(<span class="dv">5</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>+--------------------+----+
|            features|medv|
+--------------------+----+
|[6.575,0.00632,4.98]|24.0|
|[6.421,0.02731,9.14]|21.6|
|[7.185,0.02729,4.03]|34.7|
|[6.998,0.03237,2.94]|33.4|
|[7.147,0.06905,5.33]|36.2|
+--------------------+----+
only showing top 5 rows

</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Sử dụng phương thức <code>transform</code> trên mô hình được huấn luyện để xem dự đoán của nó.</p>
<p><code>lrModel</code> là một estimator, ta có thể biến đổi dữ liệu bằng cách sử dụng phương thức <code>.transform()</code> của nó.</p>
</div>
<div class="cell code" data-execution_count="11">
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>predictionDF <span class="op">=</span> lrModel.transform(subsetDF)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>predictionDF.show(<span class="dv">5</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>+--------------------+----+------------------+
|            features|medv|        prediction|
+--------------------+----+------------------+
|[6.575,0.00632,4.98]|24.0| 28.85771764778442|
|[6.421,0.02731,9.14]|21.6|25.645644850540148|
|[7.185,0.02729,4.03]|34.7| 32.58746300992211|
|[6.998,0.03237,2.94]|33.4| 32.24191904275642|
|[7.147,0.06905,5.33]|36.2|31.632888345842236|
+--------------------+----+------------------+
only showing top 5 rows

</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Bây giờ, ta thử dự đoán giá nhà cho một điểm dữ liệu mới của một ngôi nhà 6 phòng ngủ (<code>rm = 6</code>), với tỷ lệ tội phạm là 3.6 (<code>crim = 3.6</code>), và tầng lớp có thu nhập thấp hơn trung bình là 12% (<code>lstat = 12</code>). Theo công thức ở trên, mô hình sẽ dự đoán giá nhà khoảng 21.</p>
</div>
<div class="cell code" data-execution_count="12">
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.linalg <span class="im">import</span> Vectors</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [(Vectors.dense([<span class="fl">6.</span>, <span class="fl">3.6</span>, <span class="fl">12.</span>]), )]              <span class="co"># Tạo new data point</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>predictDF <span class="op">=</span> spark.createDataFrame(data, [<span class="st">&quot;features&quot;</span>])</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>lrModel.transform(predictDF).show()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>+--------------+------------------+
|      features|        prediction|
+--------------+------------------+
|[6.0,3.6,12.0]|21.427061506649363|
+--------------+------------------+

</code></pre>
</div>
</div>
<section id="19-tạo-ml-pipeline-và-đánh-giá-dùng-phương-pháp-hold-out" class="cell markdown">
<h3>1.9. Tạo ML pipeline và đánh giá dùng phương pháp hold out</h3>
</section>
<div class="cell code" data-execution_count="13">
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.regression <span class="im">import</span> LinearRegression</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml <span class="im">import</span> Pipeline</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.tuning <span class="im">import</span> TrainValidationSplit, ParamGridBuilder</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.evaluation <span class="im">import</span> RegressionEvaluator</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.feature <span class="im">import</span> StandardScaler</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pprint</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>pp <span class="op">=</span> pprint.PrettyPrinter(indent <span class="op">=</span> <span class="dv">4</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a LinearRegression instance. This instance is an Estimator.</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> LinearRegression(labelCol<span class="op">=</span><span class="st">&quot;medv&quot;</span>, featuresCol<span class="op">=</span><span class="st">&quot;features&quot;</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a StandardScaler to normalize each feature to have zero mean and unit standard deviation</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler(inputCol <span class="op">=</span> <span class="st">&quot;features&quot;</span>, outputCol <span class="op">=</span> <span class="st">&quot;scaledFeatures&quot;</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>                        withStd <span class="op">=</span> <span class="va">True</span>, withMean <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure an ML pipeline, which consists of two stages: scaler and lr.</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline(stages <span class="op">=</span> [scaler, lr])</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify parameters</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>paramGrid <span class="op">=</span> ParamGridBuilder() <span class="op">\</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    .addGrid(lr.regParam, [<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span>]) <span class="op">\</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    .build()</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Train/test split</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>trainDF, testDF <span class="op">=</span> bostonFeaturizedDF.randomSplit([<span class="fl">.8</span>, <span class="fl">.2</span>], seed <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup TrainValidationSplit </span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="co"># A TrainValidationSplit requires an Estimator, a set of Estimator ParamMaps, and an Evaluator.</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="co"># trainRatio = 0.8: 80% of the data will be used for training, 20% for testing</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>tvs <span class="op">=</span> TrainValidationSplit(estimator <span class="op">=</span> pipeline, </span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>                           estimatorParamMaps <span class="op">=</span> paramGrid, </span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>                           evaluator <span class="op">=</span> RegressionEvaluator(labelCol <span class="op">=</span> <span class="st">&quot;medv&quot;</span>, metricName <span class="op">=</span> <span class="st">&quot;rmse&quot;</span>), </span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>                           trainRatio <span class="op">=</span> <span class="fl">0.8</span>)</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Run cross-validation on training data, and choose the best set of parameters</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>lrModel <span class="op">=</span> tvs.fit(trainDF)</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Print rmse on validation set for each `regParam`: 1, 0.1, 0.01</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lrModel.validationMetrics)</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions on test data. cvModel uses the best model found (regParam = 0.1)</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>prediction <span class="op">=</span> lrModel.transform(testDF)</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> prediction.select(<span class="st">&quot;features&quot;</span>, <span class="st">&quot;scaledFeatures&quot;</span>, <span class="st">&quot;medv&quot;</span>, <span class="st">&quot;prediction&quot;</span>).collect()</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Print some predictions</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> result[<span class="dv">0</span>:<span class="dv">5</span>]:</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>    pp.pprint(<span class="st">&quot;features=</span><span class="sc">%s</span><span class="st">, scaledFeatures=</span><span class="sc">%s</span><span class="st">, label=</span><span class="sc">%s</span><span class="st"> -&gt; prediction=</span><span class="sc">%s</span><span class="st">&quot;</span> <span class="op">%</span> </span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>              (row.features, row.scaledFeatures, row.medv, row.prediction))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>[6.147526277317931, 6.368200422041555, 6.398422404073777]
(&#39;features=[7.249,0.01311,4.81], &#39;
 &#39;scaledFeatures=[1.4164431814772305,-0.4648881655422324,-1.092220358196006], &#39;
 &#39;label=35.4 -&gt; prediction=31.724843080902087&#39;)
(&#39;features=[7.135,0.01778,4.45], &#39;
 &#39;scaledFeatures=[1.2499947891838228,-0.4642127043800687,-1.142381331431606], &#39;
 &#39;label=32.9 -&gt; prediction=31.358533659654878&#39;)
(&#39;features=[6.516,0.0187,6.36], &#39;
 &#39;scaledFeatures=[0.3462092205029505,-0.46407963708473876,-0.8762495012093932], &#39;
 &#39;label=23.1 -&gt; prediction=27.33261565331063&#39;)
(&#39;features=[7.104,0.01951,8.05], &#39;
 &#39;scaledFeatures=[1.2047325070689492,-0.4639624800095027,-0.6407715990756024], &#39;
 &#39;label=33.0 -&gt; prediction=29.307524854443365&#39;)
(&#39;features=[8.034,0.02009,2.88], &#39;
 &#39;scaledFeatures=[2.5626009705151724,-0.463878589758099,-1.36113890915353], &#39;
 &#39;label=50.0 -&gt; prediction=36.5698484440496&#39;)
</code></pre>
</div>
</div>
<section id="ii-câu-hỏi" class="cell markdown">
<h2>II. Câu hỏi</h2>
</section>
<section id="câu-hỏi-1-huấn-luyện-mô-hình-linear-regression-và-dùng-nó-để-dự-đoán-cho-dữ-liệu-mới" class="cell markdown">
<h3><strong>Câu hỏi 1</strong>: Huấn luyện mô hình Linear Regression và dùng nó để dự đoán cho dữ liệu mới</h3>
<h4 id="a-tạo-mô-hình-linear-regression">a. Tạo mô hình Linear Regression</h4>
<p>Tạo một mô hình linear regression mới với input là các biến <code>indus</code>, <code>age</code>, <code>dis</code>, và output là biến <code>medv</code>.</p>
</section>
<div class="cell markdown">
<p>i. Tạo biến <code>newFeatures</code> cho huấn luyện mô hình</p>
</div>
<div class="cell code" data-execution_count="26">
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your code here</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.feature <span class="im">import</span> VectorAssembler</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>newFeatureCols <span class="op">=</span> [<span class="st">&quot;indus&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;dis&quot;</span>]</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>assembler <span class="op">=</span> VectorAssembler(inputCols <span class="op">=</span>newFeatureCols, outputCol <span class="op">=</span> <span class="st">&quot;newFeatures&quot;</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>bostonFeaturizedDF <span class="op">=</span> assembler.transform(bostonDF)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>bostonFeaturizedDF.show(<span class="dv">5</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>+-------+----+-----+----+-----+-----+----+------+---+---+-------+------+-----+----+------------------+
|   crim|  zn|indus|chas|  nox|   rm| age|   dis|rad|tax|ptratio|     b|lstat|medv|       newFeatures|
+-------+----+-----+----+-----+-----+----+------+---+---+-------+------+-----+----+------------------+
|0.00632|18.0| 2.31|   0|0.538|6.575|65.2|  4.09|  1|296|   15.3| 396.9| 4.98|24.0|  [2.31,65.2,4.09]|
|0.02731| 0.0| 7.07|   0|0.469|6.421|78.9|4.9671|  2|242|   17.8| 396.9| 9.14|21.6|[7.07,78.9,4.9671]|
|0.02729| 0.0| 7.07|   0|0.469|7.185|61.1|4.9671|  2|242|   17.8|392.83| 4.03|34.7|[7.07,61.1,4.9671]|
|0.03237| 0.0| 2.18|   0|0.458|6.998|45.8|6.0622|  3|222|   18.7|394.63| 2.94|33.4|[2.18,45.8,6.0622]|
|0.06905| 0.0| 2.18|   0|0.458|7.147|54.2|6.0622|  3|222|   18.7| 396.9| 5.33|36.2|[2.18,54.2,6.0622]|
+-------+----+-----+----+-----+-----+----+------+---+---+-------+------+-----+----+------------------+
only showing top 5 rows

</code></pre>
</div>
</div>
<div class="cell markdown">
<p>ii. Huấn luyện mô hình</p>
</div>
<div class="cell code" data-execution_count="27">
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your code here</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.regression <span class="im">import</span> LinearRegression</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> LinearRegression(labelCol <span class="op">=</span> <span class="st">&quot;medv&quot;</span>, featuresCol <span class="op">=</span> <span class="st">&quot;newFeatures&quot;</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<p>iii. In kết quả của mô hình (các hệ số và <span class="math inline"><em>R</em><sup>2</sup></span> score )</p>
</div>
<div class="cell code" data-execution_count="28">
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your code here</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>lrModel <span class="op">=</span> lr.fit(bostonFeaturizedDF)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Coefficients: </span><span class="sc">{0:.1f}</span><span class="st">, </span><span class="sc">{1:.1f}</span><span class="st">, </span><span class="sc">{2:.1f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="op">*</span>lrModel.coefficients))</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Intercept: </span><span class="sc">{0:.1f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModel.intercept))</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;R-Squared score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModel.summary.r2))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Coefficients: -0.7, -0.1, -1.5
Intercept: 43.0
R-Squared score: 0.28545147539354365
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>iv. Diễn giải các hệ số (<code>Coefficients</code>, <code>Intercept</code>), <span class="math inline"><em>R</em><sup>2</sup></span> <code>score</code>, <code>RMSE score</code>, các <code>Standard Errors</code>, <code>t-values</code>, <code>p-values</code> của mô hình.</p>
</div>
<div class="cell code" data-execution_count="29">
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your code here</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>lrModelSummary <span class="op">=</span> lrModel.summary</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;MAE score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModelSummary.meanAbsoluteError))</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;RMSE score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModelSummary.rootMeanSquaredError))</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Coefficient Standard Errors: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(lrModelSummary.coefficientStandardErrors))</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;T Values: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(lrModelSummary.tValues))</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P Values: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(lrModelSummary.pValues))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>MAE score: 5.560969336121601
RMSE score: 7.766715476913
Coefficient Standard Errors: [0.07389071808161014, 0.01915733859996422, 0.2771928541130852, 2.3152900779056473]
T Values: [-9.954031888835786, -4.907552574046936, -5.573530886805179, 18.586985332722794]
P Values: [0.0, 1.2485850908738882e-06, 4.079797522038575e-08, 0.0]
</code></pre>
</div>
</div>
<section id="b-sử-dụng-mô-hình" class="cell markdown">
<h4>b. Sử dụng mô hình</h4>
<p>Dùng mô hình huấn luyện được để dự đoán cho các điểm dữ liệu mới có (<code>indus</code>, <code>age</code>, <code>dis</code>) lần lượt là <code>(11, 68, 4)</code>, <code>(6, 35, 2)</code>, <code>(19, 74, 8)</code>.</p>
</section>
<div class="cell code" data-execution_count="35">
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your code here</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.linalg <span class="im">import</span> Vectors</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [(Vectors.dense([<span class="dv">11</span>, <span class="dv">68</span>, <span class="dv">4</span>]), )]              <span class="co"># Tạo new data point</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>predictDF <span class="op">=</span> spark.createDataFrame(data, [<span class="st">&quot;newFeatures&quot;</span>])</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>lrModel.transform(predictDF).show()</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [(Vectors.dense([<span class="dv">6</span>, <span class="dv">35</span>, <span class="dv">2</span>]), )]              <span class="co"># Tạo new data point</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>predictDF <span class="op">=</span> spark.createDataFrame(data, [<span class="st">&quot;newFeatures&quot;</span>])</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>lrModel.transform(predictDF).show()</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [(Vectors.dense([<span class="dv">19</span>, <span class="dv">74</span>, <span class="dv">8</span>]), )]              <span class="co"># Tạo new data point</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>predictDF <span class="op">=</span> spark.createDataFrame(data, [<span class="st">&quot;newFeatures&quot;</span>])</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>lrModel.transform(predictDF).show()</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output stream stdout">
<pre><code>+---------------+------------------+
|    newFeatures|        prediction|
+---------------+------------------+
|[11.0,68.0,4.0]|22.370810825866748|
+---------------+------------------+

+--------------+-----------------+
|   newFeatures|       prediction|
+--------------+-----------------+
|[6.0,35.0,2.0]|32.24076584405401|
+--------------+-----------------+

+---------------+-----------------+
|    newFeatures|       prediction|
+---------------+-----------------+
|[19.0,74.0,8.0]|9.742860699127462|
+---------------+-----------------+

</code></pre>
</div>
</div>
<section id="câu-hỏi-2-traintest-split" class="cell markdown">
<h3><strong>Câu hỏi 2</strong>: Train/test split</h3>
</section>
<div class="cell markdown">
<p>Tiếp tục với input là các biến <code>indus</code>, <code>age</code>, <code>dis</code>, và output là biến <code>medv</code>.</p>
<p>Giữa <span class="math inline">80%</span> dữ liệu để làm training set, <span class="math inline">20%</span> còn lại để làm test set, thế giá trị của <code>seed</code> là MSSV của bạn.</p>
</div>
<div class="cell code" data-execution_count="49">
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>trainDF, testDF <span class="op">=</span> bostonFeaturizedDF.randomSplit([<span class="fl">.8</span>, <span class="fl">.2</span>], seed <span class="op">=</span> <span class="dv">19133035</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Số phần tử trong training set: </span><span class="sc">{</span>trainDF<span class="sc">.</span>cache()<span class="sc">.</span>count()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Số phần tử trong test set: </span><span class="sc">{</span>testDF<span class="sc">.</span>cache()<span class="sc">.</span>count()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>trainDF.show(<span class="dv">5</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Số phần tử trong training set: 396
Số phần tử trong test set: 110
+-------+----+-----+----+-----+-----+----+------+---+---+-------+------+-----+----+------------------+
|   crim|  zn|indus|chas|  nox|   rm| age|   dis|rad|tax|ptratio|     b|lstat|medv|       newFeatures|
+-------+----+-----+----+-----+-----+----+------+---+---+-------+------+-----+----+------------------+
|0.00632|18.0| 2.31|   0|0.538|6.575|65.2|  4.09|  1|296|   15.3| 396.9| 4.98|24.0|  [2.31,65.2,4.09]|
|0.01096|55.0| 2.25|   0|0.389|6.453|31.9|7.3073|  1|300|   15.3|394.72| 8.23|22.0|[2.25,31.9,7.3073]|
|0.01301|35.0| 1.52|   0|0.442|7.241|49.3|7.0379|  1|284|   15.5|394.74| 5.49|32.7|[1.52,49.3,7.0379]|
|0.01311|90.0| 1.22|   0|0.403|7.249|21.9|8.6966|  5|226|   17.9|395.93| 4.81|35.4|[1.22,21.9,8.6966]|
| 0.0136|75.0|  4.0|   0| 0.41|5.888|47.6|7.3197|  3|469|   21.1| 396.9| 14.8|18.9| [4.0,47.6,7.3197]|
+-------+----+-----+----+-----+-----+----+------+---+---+-------+------+-----+----+------------------+
only showing top 5 rows

</code></pre>
</div>
</div>
<section id="a-thực-hiện-lại-các-bước-tương-tự-như-hương-dẫn-ở-trên" class="cell markdown">
<h4>a. Thực hiện lại các bước tương tự như hương dẫn ở trên</h4>
</section>
<div class="cell markdown">
<p>i. Huấn luyện mô hình trên training set</p>
</div>
<div class="cell code" data-execution_count="50">
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your code here</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.regression <span class="im">import</span> LinearRegression</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> LinearRegression(labelCol <span class="op">=</span> <span class="st">&quot;medv&quot;</span>, featuresCol <span class="op">=</span> <span class="st">&quot;newFeatures&quot;</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<p>ii. In kết quả của mô hình (các hệ số (<code>Coefficients</code>, <code>Intercept</code>), <code>RMSE score</code>, và <span class="math inline"><em>R</em><sup>2</sup></span> <code>score</code>) trên training set</p>
</div>
<div class="cell code">
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your code here</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>lrModel <span class="op">=</span> lr.fit(trainDF)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Coefficients: </span><span class="sc">{0:.1f}</span><span class="st">, </span><span class="sc">{1:.1f}</span><span class="st">, </span><span class="sc">{2:.1f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="op">*</span>lrModel.coefficients))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Intercept: </span><span class="sc">{0:.1f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModel.intercept))</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;R-Squared score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModel.summary.r2))</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>lrModelSummary <span class="op">=</span> lrModel.summary</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;RMSE score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModelSummary.rootMeanSquaredError))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Coefficients: -0.1, 0.0, -0.0
Intercept: 34.5
R-Squared score: 0.7567439091524328
RMSE score: 4.558930514386215
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>b. Đánh giá mô hình trên test set (in ra <code>RMSE score</code>)</p>
</div>
<div class="cell code" data-execution_count="62">
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> lrModel.transform(testDF)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>lr_evaluator <span class="op">=</span> RegressionEvaluator(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    labelCol<span class="op">=</span><span class="st">&quot;medv&quot;</span>, predictionCol<span class="op">=</span><span class="st">&quot;prediction&quot;</span>, metricName<span class="op">=</span><span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> lr_evaluator.evaluate(predictions)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Root Mean Squared Error (RMSE) on test data = </span><span class="sc">%g</span><span class="st">&quot;</span> <span class="op">%</span> rmse)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Root Mean Squared Error (RMSE) on test data = 8.1603
</code></pre>
</div>
</div>
<section id="câu-hỏi-3-regularization-với-ridge-lasso-và-elasticnet-regression" class="cell markdown">
<h3><strong>Câu hỏi 3</strong>: Regularization với Ridge, Lasso, và ElasticNet regression</h3>
</section>
<div class="cell markdown">
<p>Tiếp tục với input là các biến <code>indus</code>, <code>age</code>, <code>dis</code>, và output là biến <code>medv</code>.</p>
<p>Điều chỉnh các tham số <code>regParam</code> (or <code>lambda</code>, regularization parameter) và <code>elasticNetParam</code> (or <code>alpha</code>, the ElasticNet mixing parameter, in range [0, 1]. For <code>alpha = 0</code>, the penalty is an <code>L2 penalty</code>. For <code>alpha = 1</code>, it is an <code>L1 penalty</code>.) của <code>LinearRegression</code>. Xem thêm ở <a href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.regression.LinearRegression.html#pyspark.ml.regression.LinearRegression">đây</a>.</p>
<ul>
<li><p><code>regParam = 0</code>: ordinary least squares (OLS)</p></li>
<li><p><code>regParam != 0, elasticNetParam = 0</code>: L2 (Ridge regression)</p></li>
<li><p><code>regParam != 0, elasticNetParam = 1</code>: L1 (Lasso regression)</p></li>
<li><p><code>regParam != 0, elasticNetParam != 0</code>: L2 + L1 (ElasticNet regression)</p></li>
</ul>
</div>
<section id="a-regparam--0-ordinary-least-squares" class="cell markdown">
<h4>a. <code>regParam = 0</code>: ordinary least squares</h4>
<p>Thiết lập <code>regParam = 0</code> để tạo mô hình Linear Regression.</p>
</section>
<div class="cell code" data-execution_count="65">
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your code here</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.regression <span class="im">import</span> LinearRegression</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> LinearRegression(labelCol <span class="op">=</span> <span class="st">&quot;medv&quot;</span>, featuresCol <span class="op">=</span> <span class="st">&quot;newFeatures&quot;</span>,regParam<span class="op">=</span><span class="fl">0.0</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your code here</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>lrModel <span class="op">=</span> lr.fit(trainDF)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Coefficients: </span><span class="sc">{0:.1f}</span><span class="st">, </span><span class="sc">{1:.1f}</span><span class="st">, </span><span class="sc">{2:.1f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="op">*</span>lrModel.coefficients))</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Intercept: </span><span class="sc">{0:.1f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModel.intercept))</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;R-Squared score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModel.summary.r2))</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>lrModelSummary <span class="op">=</span> lrModel.summary</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;MAE score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModelSummary.meanAbsoluteError))</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;RMSE score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModelSummary.rootMeanSquaredError))</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Coefficient Standard Errors: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(lrModelSummary.coefficientStandardErrors))</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;T Values: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(lrModelSummary.tValues))</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P Values: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(lrModelSummary.pValues))</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output stream stdout">
<pre><code>Coefficients: -0.8, -0.1, -1.6
Intercept: 44.1
R-Squared score: 0.31354183530490365
MAE score: 5.600025230895622
RMSE score: 7.658401812166801
Coefficient Standard Errors: [0.08120270753473074, 0.021770898076406187, 0.31287336987308645, 2.6052568405716077]
T Values: [-9.464059010148143, -4.542858348237782, -5.208679150275858, 16.943514690632025]
P Values: [0.0, 7.399302432764543e-06, 3.0791373228922225e-07, 0.0]
</code></pre>
</div>
</div>
<section id="b-regparam--0-elasticnetparam--0-l2-ridge-regression" class="cell markdown">
<h4>b. <code>regParam != 0, elasticNetParam = 0</code>: L2 (Ridge Regression)</h4>
<p>Chọn một giá trị khác 0 cho tham số <code>regParam</code> để tạo mô hình Ridge Regression.</p>
</section>
<div class="cell code" data-execution_count="77">
<div class="sourceCode" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your code here</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.regression <span class="im">import</span> LinearRegression</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span>LinearRegression(labelCol <span class="op">=</span> <span class="st">&quot;medv&quot;</span>, featuresCol <span class="op">=</span> <span class="st">&quot;newFeatures&quot;</span>,regParam<span class="op">=</span><span class="fl">0.1</span>,elasticNetParam<span class="op">=</span><span class="fl">0.0</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your code here</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>lrModel <span class="op">=</span> lr.fit(trainDF)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Coefficients: </span><span class="sc">{0:.1f}</span><span class="st">, </span><span class="sc">{1:.1f}</span><span class="st">, </span><span class="sc">{2:.1f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="op">*</span>lrModel.coefficients))</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Intercept: </span><span class="sc">{0:.1f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModel.intercept))</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;R-Squared score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModel.summary.r2))</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>lrModelSummary <span class="op">=</span> lrModel.summary</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;MAE score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModelSummary.meanAbsoluteError))</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;RMSE score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModelSummary.rootMeanSquaredError))</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Coefficient Standard Errors: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(lrModelSummary.coefficientStandardErrors))</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;T Values: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(lrModelSummary.tValues))</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;P Values: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(lrModelSummary.pValues))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Coefficients: -0.7, -0.1, -1.5
Intercept: 43.3
R-Squared score: 0.3133422845522711
MAE score: 5.5904781983693566
RMSE score: 7.659514865282743
Coefficient Standard Errors: [0.08002863210800656, 0.021378839327626846, 0.3064305196126458, 2.5503396830640783]
T Values: [-9.355477973478292, -4.475509408650018, -5.007626499602583, 16.99457613231429]
P Values: [0.0, 1.0005179076344461e-05, 8.346942454995343e-07, 0.0]
</code></pre>
</div>
</div>
<section id="c-regparam--0-elasticnetparam--1-l1-lasso-regression" class="cell markdown">
<h4>c. <code>regParam != 0, elasticNetParam = 1</code>: L1 (Lasso regression)</h4>
<p>Chọn một giá trị khác 0 cho tham số <code>regParam</code> và thiết lập <code>elasticNetParam = 1</code> để tạo mô hình Lasso Regression.</p>
</section>
<div class="cell code" data-execution_count="81">
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your code here</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your code here</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.regression <span class="im">import</span> LinearRegression</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span>LinearRegression(labelCol <span class="op">=</span> <span class="st">&quot;medv&quot;</span>, featuresCol <span class="op">=</span> <span class="st">&quot;newFeatures&quot;</span>,regParam<span class="op">=</span><span class="fl">0.3</span>,elasticNetParam<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your code here</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>lrModel <span class="op">=</span> lr.fit(trainDF)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Coefficients: </span><span class="sc">{0:.1f}</span><span class="st">, </span><span class="sc">{1:.1f}</span><span class="st">, </span><span class="sc">{2:.1f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="op">*</span>lrModel.coefficients))</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Intercept: </span><span class="sc">{0:.1f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModel.intercept))</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;R-Squared score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModel.summary.r2))</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>lrModelSummary <span class="op">=</span> lrModel.summary</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;MAE score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModelSummary.meanAbsoluteError))</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;RMSE score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModelSummary.rootMeanSquaredError))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Coefficients: -0.7, -0.1, -0.9
Intercept: 37.5
R-Squared score: 0.3016884873864013
MAE score: 5.601937338571584
RMSE score: 7.724239163475788
</code></pre>
</div>
</div>
<section id="d-regparam--0-elasticnetparam--0-l2--l1-elasticnet-regression" class="cell markdown">
<h4>d. <code>regParam != 0, elasticNetParam != 0</code>: L2 + L1 (ElasticNet Regression)</h4>
<p>Chọn hai giá trị khác 0 cho tham số <code>regParam</code> và <code>elasticNetParam</code> để tạo mô hình ElasticNet Regression.</p>
</section>
<div class="cell code" data-execution_count="80">
<div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your code here</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your code here</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.regression <span class="im">import</span> LinearRegression</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span>LinearRegression(labelCol <span class="op">=</span> <span class="st">&quot;medv&quot;</span>, featuresCol <span class="op">=</span> <span class="st">&quot;newFeatures&quot;</span>,regParam<span class="op">=</span><span class="fl">0.3</span>,elasticNetParam<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Write your code here</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>lrModel <span class="op">=</span> lr.fit(trainDF)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Coefficients: </span><span class="sc">{0:.1f}</span><span class="st">, </span><span class="sc">{1:.1f}</span><span class="st">, </span><span class="sc">{2:.1f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(<span class="op">*</span>lrModel.coefficients))</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Intercept: </span><span class="sc">{0:.1f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModel.intercept))</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;R-Squared score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModel.summary.r2))</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>lrModelSummary <span class="op">=</span> lrModel.summary</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;MAE score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModelSummary.meanAbsoluteError))</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;RMSE score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(lrModelSummary.rootMeanSquaredError))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Coefficients: -0.7, -0.1, -1.0
Intercept: 38.5
R-Squared score: 0.30485310377330077
MAE score: 5.590728765966802
RMSE score: 7.706716889740107
</code></pre>
</div>
</div>
<section id="e-nhận-xét-kết-quả-của-các-mô-hình-ở-a-b-c-d" class="cell markdown">
<h4>e. Nhận xét kết quả của các mô hình ở a, b, c, d.</h4>
<ul>
<li><p>Dựa vào kết quả ta có thể thấy thuật toán ElasticNet Regression có độ chính xác thấp nhất so với 3 thuật toán trên với R-Squared score là 0.3</p></li>
<li><p>Mặc dù 3 thuật toán kia có độ chính xác cao nhưng nó chỉ xem xem nhau đều gần bằng 0.31. Trong đó Linear Regression có độ chính xác cao hơn 2 thuật toán kia 1 chút với R-squared score là 0.31</p></li>
</ul>
</section>
<section id="câu-hỏi-4-tạo-ml-pipeline-và-đánh-giá-các-mô-hình-dùng-cross-validation" class="cell markdown">
<h3><strong>Câu hỏi 4</strong>: Tạo ML pipeline và đánh giá các mô hình dùng cross validation</h3>
<p><strong>Tham khảo</strong></p>
<ol>
<li>ML Pipeline: <a href="https://spark.apache.org/docs/latest/ml-pipeline.html" class="uri">https://spark.apache.org/docs/latest/ml-pipeline.html</a></li>
<li>ML Tuning: <a href="https://spark.apache.org/docs/latest/ml-tuning.html" class="uri">https://spark.apache.org/docs/latest/ml-tuning.html</a></li>
</ol>
<p><strong>Lưu ý:</strong></p>
<ul>
<li><p>Ở câu hỏi này, bạn cần sử dụng tất cả các thuộc tính khác <code>medv</code> làm input (<code>features</code>) và <code>medv</code> làm output (<code>label</code>) để tận dụng tối đa thông tin đã có nhất có thể.</p></li>
<li><p>Bạn cần thiết lập các tham số <code>regParam</code> và <code>elasticNetParam</code> là một danh sách các giá trị để bao gồm các mô hình Linear Regression, Ridge Regression, Lasso Regression, và ElasticNet Regression. Mỗi tham số tối thiểu 5 giá trị khác nhau. Chú ý rằng:</p>
<ul>
<li><p><code>regParam != 0</code> và <code>elasticNetParam = 0</code> ứng với Ridge Regression</p></li>
<li><p><code>regParam != 0</code> và <code>elasticNetParam = 1</code> ứng với Lasso Regression</p></li>
<li><p><code>regParam != 0</code> và <code>elasticNetParam != 0</code> ứng với ElasticNet Regression</p></li>
</ul></li>
</ul>
</section>
<div class="cell code" data-execution_count="83">
<div class="sourceCode" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>featureCols <span class="op">=</span> [ <span class="st">&quot;crim&quot;</span>, <span class="st">&quot;zn&quot;</span>,<span class="st">&quot;indus&quot;</span>, <span class="st">&quot;chas&quot;</span>,<span class="st">&quot;nox&quot;</span>,<span class="st">&quot;rm&quot;</span>,<span class="st">&quot;age&quot;</span>,<span class="st">&quot;dis&quot;</span>,<span class="st">&quot;rad&quot;</span>,<span class="st">&quot;tax&quot;</span>,<span class="st">&quot;ptratio&quot;</span>,<span class="st">&quot;b&quot;</span>,<span class="st">&quot;lstat&quot;</span>,]</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>assembler <span class="op">=</span> VectorAssembler(inputCols <span class="op">=</span> featureCols, outputCol <span class="op">=</span> <span class="st">&quot;features&quot;</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>bostonFeaturizedDF <span class="op">=</span> assembler.transform(bostonDF)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>bostonFeaturizedDF.show(<span class="dv">5</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>+-------+----+-----+----+-----+-----+----+------+---+---+-------+------+-----+----+--------------------+
|   crim|  zn|indus|chas|  nox|   rm| age|   dis|rad|tax|ptratio|     b|lstat|medv|            features|
+-------+----+-----+----+-----+-----+----+------+---+---+-------+------+-----+----+--------------------+
|0.00632|18.0| 2.31|   0|0.538|6.575|65.2|  4.09|  1|296|   15.3| 396.9| 4.98|24.0|[0.00632,18.0,2.3...|
|0.02731| 0.0| 7.07|   0|0.469|6.421|78.9|4.9671|  2|242|   17.8| 396.9| 9.14|21.6|[0.02731,0.0,7.07...|
|0.02729| 0.0| 7.07|   0|0.469|7.185|61.1|4.9671|  2|242|   17.8|392.83| 4.03|34.7|[0.02729,0.0,7.07...|
|0.03237| 0.0| 2.18|   0|0.458|6.998|45.8|6.0622|  3|222|   18.7|394.63| 2.94|33.4|[0.03237,0.0,2.18...|
|0.06905| 0.0| 2.18|   0|0.458|7.147|54.2|6.0622|  3|222|   18.7| 396.9| 5.33|36.2|[0.06905,0.0,2.18...|
+-------+----+-----+----+-----+-----+----+------+---+---+-------+------+-----+----+--------------------+
only showing top 5 rows

</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="98">
<div class="sourceCode" id="cb48"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.regression <span class="im">import</span> LinearRegression</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml <span class="im">import</span> Pipeline</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.tuning <span class="im">import</span> TrainValidationSplit, ParamGridBuilder</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.evaluation <span class="im">import</span> RegressionEvaluator</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.feature <span class="im">import</span> StandardScaler</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pprint</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>pp <span class="op">=</span> pprint.PrettyPrinter(indent <span class="op">=</span> <span class="dv">4</span>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a LinearRegression instance. This instance is an Estimator.</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> LinearRegression(labelCol<span class="op">=</span><span class="st">&quot;medv&quot;</span>, featuresCol<span class="op">=</span><span class="st">&quot;features&quot;</span>)</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a StandardScaler to normalize each feature to have zero mean and unit standard deviation</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler(inputCol <span class="op">=</span> <span class="st">&quot;features&quot;</span>, outputCol <span class="op">=</span> <span class="st">&quot;scaledFeatures&quot;</span>,</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>                        withStd <span class="op">=</span> <span class="va">True</span>, withMean <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure an ML pipeline, which consists of two stages: scaler and lr.</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline(stages <span class="op">=</span> [scaler, lr])</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify parameters</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>paramGrid <span class="op">=</span> ParamGridBuilder() <span class="op">\</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>    .addGrid(lr.regParam, [<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="dv">0</span>, <span class="fl">0.11</span>, <span class="fl">0.58</span>, <span class="fl">0.15</span>, <span class="fl">1.</span>, ]) <span class="op">\</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>    .addGrid(lr.elasticNetParam, [<span class="fl">0.0</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">0.01</span>, <span class="fl">0.95</span>, <span class="fl">0.0</span>, <span class="fl">0.85</span>, <span class="fl">0.75</span> ])<span class="op">\</span></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>    .build()</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Train/test split</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>trainDF, testDF <span class="op">=</span> bostonFeaturizedDF.randomSplit([<span class="fl">.8</span>, <span class="fl">.2</span>], seed <span class="op">=</span> <span class="dv">19133035</span>)</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup TrainValidationSplit </span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a><span class="co"># A TrainValidationSplit requires an Estimator, a set of Estimator ParamMaps, and an Evaluator.</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a><span class="co"># trainRatio = 0.8: 80% of the data will be used for training, 20% for testing</span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>tvs <span class="op">=</span> TrainValidationSplit(estimator <span class="op">=</span> pipeline, </span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>                           estimatorParamMaps <span class="op">=</span> paramGrid, </span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>                           evaluator <span class="op">=</span> RegressionEvaluator(labelCol <span class="op">=</span> <span class="st">&quot;medv&quot;</span>, metricName <span class="op">=</span> <span class="st">&quot;rmse&quot;</span>), </span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>                           trainRatio <span class="op">=</span> <span class="fl">0.8</span>)</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Run cross-validation on training data, and choose the best set of parameters</span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>lrModel <span class="op">=</span> tvs.fit(trainDF)</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Print rmse on validation set for each `regParam`: 1, 0.1, 0.01</span></span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lrModel.validationMetrics)</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions on test data. cvModel uses the best model found (regParam = 0.1)</span></span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>prediction <span class="op">=</span> lrModel.transform(testDF)</span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> prediction.select(<span class="st">&quot;features&quot;</span>, <span class="st">&quot;scaledFeatures&quot;</span>, <span class="st">&quot;medv&quot;</span>, <span class="st">&quot;prediction&quot;</span>).collect()</span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Print some predictions</span></span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> result[<span class="dv">0</span>:<span class="dv">5</span>]:</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a>    pp.pprint(<span class="st">&quot;features=</span><span class="sc">%s</span><span class="st">, scaledFeatures=</span><span class="sc">%s</span><span class="st">, label=</span><span class="sc">%s</span><span class="st"> -&gt; prediction=</span><span class="sc">%s</span><span class="st">&quot;</span> <span class="op">%</span> </span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a>              (row.features, row.scaledFeatures, row.medv, row.prediction))</span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a>bestModel<span class="op">=</span>lrModel.bestModel</span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output stream stdout">
<pre><code>[5.097214856874839, 5.431574593036092, 5.4271281444813795, 5.104019078780572, 5.428179499440657, 5.097214856874839, 5.427031498011888, 5.428588095356006, 5.079313784229277, 5.122983388533588, 5.184895212138924, 5.080086719089299, 5.177909758385377, 5.079313784229277, 5.164254015452356, 5.151469314375788, 5.070973864279012, 5.074459974386994, 5.078110355025067, 5.071064041120858, 5.07774996028774, 5.070973864279012, 5.077071385239468, 5.076259094195653, 5.069925336657595, 5.069925336657595, 5.069925336657595, 5.069925336657595, 5.069925336657595, 5.069925336657595, 5.069925336657595, 5.069925336657595, 5.080123735774617, 5.129089921317742, 5.200585856972861, 5.080926293343949, 5.192305883452861, 5.080123735774617, 5.176448129669989, 5.1616813306970055, 5.098888025787442, 5.370707927780618, 5.485764907190164, 5.103112285475868, 5.482220361178015, 5.098888025787442, 5.477757505422885, 5.476642290682196, 5.083145483737551, 5.154894564455192, 5.269528477708118, 5.08422460975808, 5.255773304018753, 5.083145483737551, 5.22985113204865, 5.206035559011729, 5.097214856874839, 5.431574593036092, 5.4271281444813795, 5.104019078780572, 5.428179499440657, 5.097214856874839, 5.427031498011888, 5.428588095356006]
(&#39;features=[0.00906,90.0,2.97,0.0,0.4,7.088,20.8,7.3073,1.0,285.0,15.3,394.72,7.85], &#39;
 &#39;scaledFeatures=[-0.41332493438362383,3.342355963269905,-1.1952360370701043,-0.2592590971970519,-1.3510857815641282,1.138198756115313,-1.7394877907922275,1.7204542798732219,-0.9788180308967985,-0.736467752047462,-1.474998678494747,0.4149140229066433,-0.6817901000864749], &#39;
 &#39;label=32.2 -&gt; prediction=31.738527791657713&#39;)
(&#39;features=[0.02009,95.0,2.68,0.0,0.4161,8.034,31.9,5.118,4.0,224.0,14.7,390.55,2.88], &#39;
 &#39;scaledFeatures=[-0.4121214408441576,3.5550088707512892,-1.2372416516030853,-0.2592590971970519,-1.2106185810817662,2.488932479583392,-1.3421127143581495,0.6688034312375242,-0.6342740840211251,-1.098533794959001,-1.756198779602308,0.36937116756663213,-1.381991382606132], &#39;
 &#39;label=50.0 -&gt; prediction=43.53725327522015&#39;)
(&#39;features=[0.02731,0.0,7.07,0.0,0.469,6.421,78.9,4.9671,2.0,242.0,17.8,396.9,9.14], &#39;
 &#39;scaledFeatures=[-0.41133365994162396,-0.48539637139500796,-0.601363555741755,-0.2592590971970519,-0.7490834937825774,0.18583153248612966,0.3404664381104691,0.5963171967976909,-0.8639700486049073,-0.9916946347555959,-0.3033315905465795,0.43872299764074923,-0.5000477148851956], &#39;
 &#39;label=21.6 -&gt; prediction=24.78505365225961&#39;)
(&#39;features=[0.02985,0.0,2.18,0.0,0.458,6.43,58.7,6.0622,3.0,222.0,18.7,394.12,5.21], &#39;
 &#39;scaledFeatures=[-0.4110565181836689,-0.48539637139500796,-1.3096651249358107,-0.2592590971970519,-0.8450548729941287,0.1986820647389964,-0.38268460188668185,1.1223587828484616,-0.7491220663130163,-1.1104048127593793,0.1184685611147602,0.4083610940807422,-1.0537280046844417], &#39;
 &#39;label=28.7 -&gt; prediction=25.068256044367175&#39;)
(&#39;features=[0.03306,0.0,5.19,0.0,0.515,6.059,37.3,4.8122,5.0,224.0,20.2,396.14,8.51], &#39;
 &#39;scaledFeatures=[-0.4107062721037336,-0.48539637139500796,-0.8736758154728029,-0.2592590971970519,-0.34774863526154304,-0.3310454314625429,-1.148795109606436,0.5219095247318845,-0.519426101729234,-1.098533794959001,0.8214688138836608,0.43042262112794155,-0.5888056239369832], &#39;
 &#39;label=20.6 -&gt; prediction=22.390720101393676&#39;)
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="113">
<div class="sourceCode" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>lrModel.bestModel.stages[<span class="dv">1</span>].getElasticNetParam()</span></code></pre></div>
<div class="output execute_result" data-execution_count="113">
<pre><code>0.0</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="114">
<div class="sourceCode" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>bestModel.stages[<span class="dv">1</span>].getRegParam()</span></code></pre></div>
<div class="output execute_result" data-execution_count="114">
<pre><code>0.0</code></pre>
</div>
</div>
</body>
</html>
